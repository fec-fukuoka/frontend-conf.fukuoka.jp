---
import { getCollection, render } from "astro:content";
import PageLayout from "../../../layouts/PageLayout.astro";
import { getLangFromRequest, useTranslations } from "../../../i18n/utils";

const lang = getLangFromRequest(Astro.request, Astro.url);
const t = useTranslations(lang);
const { slug } = Astro.params;

// Find the speaker by slug and language
const speakers = await getCollection("speakers", ({ data }) => {
  return data.locale === lang && data.year === 2026 && !data.draft;
});

const speaker = speakers.find(
  (s) => s.id.replace(/^.*\//, "").replace(".md", "") === slug
);

if (!speaker) {
  return Astro.redirect("/404");
}

const { Content } = await render(speaker);
---

<PageLayout
  title={`${speaker.data.name} - ${speaker.data.sessionTitle}`}
  description={speaker.data.bio}
  lang={speaker.data.locale}
>
  <div class="container">
    <article class="speaker-detail">
      <header class="speaker-header">
        {
          speaker.data.image && (
            <img
              src={speaker.data.image}
              alt={speaker.data.name}
              class="speaker-avatar"
            />
          )
        }
        <div class="speaker-meta">
          <h1>{speaker.data.name}</h1>
          <p class="bio">{speaker.data.bio}</p>
          <div class="social-links">
            {
              speaker.data.twitter && (
                <a
                  href={`https://twitter.com/${speaker.data.twitter}`}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Twitter
                </a>
              )
            }
            {
              speaker.data.github && (
                <a
                  href={`https://github.com/${speaker.data.github}`}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  GitHub
                </a>
              )
            }
            {
              speaker.data.website && (
                <a
                  href={speaker.data.website}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Website
                </a>
              )
            }
          </div>
        </div>
      </header>

      <section class="session-info">
        <h2>{speaker.data.sessionTitle}</h2>
        <div class="session-meta">
          <span class="category">{speaker.data.sessionCategory}</span>
          <span class="track">{speaker.data.track}</span>
          <span class="time">
            {speaker.data.startTime} - {speaker.data.endTime}
          </span>
          <span class="language">
            {t("label.language")}: {speaker.data.language}
          </span>
        </div>
        <div class="session-description">
          <Content />
        </div>
      </section>
    </article>
  </div>
</PageLayout>
